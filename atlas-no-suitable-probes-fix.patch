diff --git a/functions/api/atlas/measurements-pair.js b/functions/api/atlas/measurements-pair.js
index 6d7de34..cc5dc61 100644
--- a/functions/api/atlas/measurements-pair.js
+++ b/functions/api/atlas/measurements-pair.js
@@ -99,6 +99,27 @@ function parseAtlasProbeRequest(location, requested) {
   return { probes: [{ requested: req, type: "area", value: "WW" }], warnings };
 }
 
+function mergeCsvTags(existingCsv, addTags) {
+  const base = String(existingCsv || "")
+    .split(",")
+    .map((s) => s.trim())
+    .filter(Boolean);
+  const add = (addTags || []).map((s) => String(s).trim()).filter(Boolean);
+  const out = new Set([...base, ...add]);
+  return Array.from(out).join(",");
+}
+
+function enforceDualStackProbes(probes) {
+  // We always create a v4+v6 pair. To avoid "No suitable probes" on the v4 side
+  // (e.g., when v6 selected v6-only probes), require probes that can do both.
+  // These are system tags documented by RIPE Atlas.
+  const mustHave = ["system-ipv4-works", "system-ipv6-works"];
+  return (probes || []).map((p) => ({
+    ...p,
+    tags_include: mergeCsvTags(p.tags_include, mustHave),
+  }));
+}
+
 function atlasDefinitionFor(cmd, af, target, measurementOptions) {
   const type = String(cmd);
   const base = {
@@ -224,32 +245,24 @@ export async function onRequestPost(context) {
   }
 
   const { probes, warnings } = parseAtlasProbeRequest(base.locations?.[0] || {}, limit);
+  const probesDualStack = enforceDualStackProbes(probes);
 
   try {
-    // 1) Create IPv6 measurement
-    const def6 = atlasDefinitionFor(base.type, 6, String(base.target).trim(), measurementOptions);
-    const create6 = await atlasPost(
-      "/api/v2/measurements/",
-      { definitions: [def6], probes },
-      apiKey,
-      request.signal
-    );
-    const msm6 = Array.isArray(create6?.measurements) ? create6.measurements[0] : null;
-    if (!msm6) return json({ error: "atlas_create_failed", details: create6 || {} }, 502);
-
-    // 2) Create IPv4 measurement using the exact same probes as the v6 measurement
+    // Create the IPv4+IPv6 pair in a *single* Atlas API request.
+    // RIPE Atlas guarantees that measurements created in one request share the same allocated probes,
+    // and the response "measurements" array matches the order in "definitions".
     const def4 = atlasDefinitionFor(base.type, 4, String(base.target).trim(), measurementOptions);
-    const create4 = await atlasPost(
+    const def6 = atlasDefinitionFor(base.type, 6, String(base.target).trim(), measurementOptions);
+    const created = await atlasPost(
       "/api/v2/measurements/",
-      {
-        definitions: [def4],
-        probes: [{ requested: limit, type: "msm", value: String(msm6) }],
-      },
+      { definitions: [def4, def6], probes: probesDualStack },
       apiKey,
       request.signal
     );
-    const msm4 = Array.isArray(create4?.measurements) ? create4.measurements[0] : null;
-    if (!msm4) return json({ error: "atlas_create_failed", details: create4 || {} }, 502);
+    const ids = Array.isArray(created?.measurements) ? created.measurements : [];
+    const msm4 = ids[0];
+    const msm6 = ids[1];
+    if (!msm4 || !msm6) return json({ error: "atlas_create_failed", details: created || {} }, 502);
 
     // Mirror the Globalping handler response shape.
     return json({
